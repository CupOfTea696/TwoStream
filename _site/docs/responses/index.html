<!DOCTYPE html><html lang="en-us" id="twostream"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>TwoStream by CupOfTea696</title><base href="http://twostream.cupoftea.io"><link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/css/app.css?cb=79a4a10e5dcc99daa5f83d42d21bfd62"></head><body> <nav class="nav"> <section class="nav/left"> <a href="" class="nav/item">TwoStream</a> </section> <section class="nav/right"> <a href="docs" class="nav/item">Documentation</a> <a href="docs/api" class="nav/item">API</a> </section> </nav><section class="main-content" id="docs-responses"><div class="body clearfix"><ol class="breadcrumb"><li class="breadcrumb/item"> <a href="">Home</a></li><li class="breadcrumb/item"> <a href="docs">Documentation</a></li><li class="breadcrumb/item --active">Responses</li></ol> <aside class="sidebar"> <nav><ul class="sidebar/nav"><li class="sidebar/nav/category">Getting Started</li><li class="sidebar/nav/item"> <a href="docs/installation">Installation</a></li><li class="sidebar/nav/item"> <a href="docs/configuration">Configuration</a></li><li class="sidebar/nav/item"> <a href="docs/server">Running TwoStream</a></li><li class="sidebar/nav/category">The Basics</li><li class="sidebar/nav/item"> <a href="docs/routing">Routing</a></li><li class="sidebar/nav/item"> <a href="docs/controllers">Controllers</a></li><li class="sidebar/nav/item"> <a href="docs/requests">Requests</a></li><li class="sidebar/nav/item --active">Responses</li><li class="sidebar/nav/category">Services</li><li class="sidebar/nav/item"> <a href="docs/exceptions">Error Handling</a></li><li class="sidebar/nav/item"> <a href="docs/events">Events</a></li><li class="sidebar/nav/item"> <a href="docs/twostream">TwoStream</a></li><li class="sidebar/nav/item"> <a href="docs/ws-session">WsSession</a></li></ul> </nav> </aside><main id="content" class="page"><h1 id="ws">WS</h1><ul class="toc"><li class="toc/item"><a data-scrollto="basic-responses">Basic Responses</a></li><li class="toc/item"> <a data-scrollto="targeted-responses">Targeted Responses</a><ul class="toc/level toc"><li class="toc/item"><a data-scrollto="pre-defined-recipient-lists">Pre-defined Recipient Lists</a></li></ul></li><li class="toc/item"><a data-scrollto="call-responses">CALL Responses</a></li></ul><h2 id="basic-responses">Basic Responses</h2><p>All WebSocket responses are automatically encoded to JSON by TwoStream, so there is no need to convert any objects or arrays to JSON before returning them in your Controller or Closure.</p><p>Although it is possible to return views as a response, it is recommended not to do this. If you do want to use WebSockets to navigate pages (e.g. to replace all AJAX requests), only sending the required data through the WebSocket and using a front-end templating engine is a better approach.</p><h2 id="targeted-responses">Targeted Responses</h2><p>TwoStream provides an easy way to send your responses to a list of specific Clients. You can either use one of the <a href="http://twostream.cupoftea.io/docs/responses/#pre-defined-recipient-lists">Pre-defined Recipient Lists</a> or specify Clients either by their User ID or Session ID. If you provide a User Model, TwoStream will autmatically extract the ID from the Model as well. To specify the response recipients, simply return an associative array with the keys <code>recipient</code> and <code>data</code>, where where <code>recipient</code> is a User ID, User Model, Session ID or an array of any of those, and <code>data</code> is the response you want to send. The ability to send Responses to a Client by username will be added in the future.</p><div class="highlight"><pre><code class="language-php" data-lang="php"><span class="c1">// Pre-defined recipient list</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="s1">'hello world'</span><span class="p">,</span>
    <span class="s1">'recipient'</span> <span class="o">=&gt;</span> <span class="s1">'all'</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">// Specific recipient</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="s1">'hello world'</span><span class="p">,</span>
    <span class="s1">'recipient'</span> <span class="o">=&gt;</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">(),</span>
<span class="p">];</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="s1">'hello world'</span><span class="p">,</span>
    <span class="s1">'recipient'</span> <span class="o">=&gt;</span> <span class="nv">$sessionID</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></div><h3 id="pre-defined-recipient-lists">Pre-defined Recipient Lists</h3><p>The following is a list of the Pre-defined Recipient Lists that you can use for <a href="http://twostream.cupoftea.io/docs/responses/#targeted-responses">Targeted Responses</a>:</p><ul><li> <code>'all'</code>: The response will be sent to all subscribed Clients.</li><li> <code>'except'</code>: The response will be sent to all subscribed Clients except the Client that made the request.</li><li> <code>'requestee'</code>: The response will be sent to the Client that made the request.</li></ul><p><u><strong>Note:</strong> You can set a default recipient in your <a href="http://twostream.cupoftea.io/docs/configuration/#response-settings">Configuration</a>.</u></p><h2 id="call-responses">CALL Responses</h2><p>For CALL Responses there is no need to specify a recipient. It will always be sent to the requestee. As with the other responses, all return data will automatically be converted to JSON.</p><p>TwoStream provides an easy way to send Error Responses on CALL Requests. Simply return an associative array with the key <code>error</code>. The value for this key can either be a string or object with the Error data, or an associative with the keys <code>domain</code> and <code>msg</code> to specify the Error Domain and Message respectively.</p><div class="highlight"><pre><code class="language-php" data-lang="php"><span class="c1">// Simple Error Message</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'Object is write protected.'</span>
<span class="p">];</span>

<span class="c1">// Specifying the Error Domain and Message</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'domain'</span> <span class="o">=&gt;</span> <span class="s1">'com.myapp.error.object_write_protected'</span><span class="p">,</span>
        <span class="s1">'msg'</span> <span class="o">=&gt;</span> <span class="s1">'Object is write protected.'</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div> </main></div> <footer class="site-footer"> <span class="site-footer-owner"> <a href="https://github.com/CupOfTea696/TwoStream/">TwoStream</a> is maintained by <a href="https://github.com/CupOfTea696">CupOfTea696</a>. </span> </footer> </section> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="/assets/js/app.js?cb=d735cbd9e60a21104256df7ee8382009"></script></body></html>